<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  Module: FFI::BitField::ClassMethods
  
    &mdash; Documentation by YARD 0.9.37
  
</title>

  <link rel="stylesheet" href="../../css/style.css" type="text/css" />

  <link rel="stylesheet" href="../../css/common.css" type="text/css" />

<script type="text/javascript">
  pathId = "FFI::BitField::ClassMethods";
  relpath = '../../';
</script>


  <script type="text/javascript" charset="utf-8" src="../../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../../js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="../../class_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="../../_index.html">Index (C)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../../FFI.html" title="FFI (module)">FFI</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../BitField.html" title="FFI::BitField (module)">BitField</a></span></span>
     &raquo; 
    <span class="title">ClassMethods</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../../class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><h1>Module: FFI::BitField::ClassMethods
  
  
  
</h1>
<div class="box_info">
  

  
  
  
  
  

  
  <dl>
    <dt>Included in:</dt>
    <dd><span class='object_link'><a href="../BitStruct.html" title="FFI::BitStruct (class)">FFI::BitStruct</a></span>, <span class='object_link'><a href="../ManagedBitStruct.html" title="FFI::ManagedBitStruct (class)">ManagedBitStruct</a></span></dd>
  </dl>
  

  
  <dl>
    <dt>Defined in:</dt>
    <dd>lib/ffi/bit_field/class_methods.rb</dd>
  </dl>
  
</div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    
<p>ClassMethods provides methods for defining bit field layouts. This module is extended by BitStruct and ManagedBitStruct classes.</p>


  </div>
</div>
<div class="tags">
  

</div>






  
    <h2>
      Instance Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#bit_field_layout-instance_method" title="#bit_field_layout (instance method)">#<strong>bit_field_layout</strong>  &#x21d2; Hash </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns a hash of bit fields with detailed layout information.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#bit_field_members-instance_method" title="#bit_field_members (instance method)">#<strong>bit_field_members</strong>  &#x21d2; Hash </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns a hash of bit fields grouped by parent field.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#bit_field_offsets-instance_method" title="#bit_field_offsets (instance method)">#<strong>bit_field_offsets</strong>  &#x21d2; Hash </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns a hash of bit fields with their bit offsets, grouped by parent field.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#bit_fields-instance_method" title="#bit_fields (instance method)">#<strong>bit_fields</strong>(*layout_args)  &#x21d2; Symbol </a>
    

    
      (also: #bit_field)
    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Defines bit fields within a parent field.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#bit_fields_typed-instance_method" title="#bit_fields_typed (instance method)">#<strong>bit_fields_typed</strong>(parent_name, field_definitions)  &#x21d2; Symbol </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Defines typed bit fields within a parent field using hash syntax.</p>
</div></span>
  
</li>

      
    </ul>
  



  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="bit_field_layout-instance_method">
  
    #<strong>bit_field_layout</strong>  &#x21d2; <tt>Hash</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns a hash of bit fields with detailed layout information.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <h4 class="tag_title">Examples:</h4>
    
      
        <h5 class="example_title"><div class='inline'>
<p>Get detailed bit field layout in a struct</p>
</div></h5>
      
      <pre class="example code"><code><span class='kw'>class</span> <span class='const'>Flags</span> <span class='op'>&lt;</span> <span class='const'><span class='object_link'><a href="../../FFI.html" title="FFI (module)">FFI</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../BitStruct.html" title="FFI::BitStruct (class)">BitStruct</a></span></span>
  <span class='id identifier rubyid_layout'>layout</span> \
    <span class='symbol'>:value</span><span class='comma'>,</span> <span class='symbol'>:uint8</span>

  <span class='id identifier rubyid_bit_fields'>bit_fields</span> <span class='symbol'>:value</span><span class='comma'>,</span>
    <span class='symbol'>:read</span><span class='comma'>,</span>    <span class='int'>1</span><span class='comma'>,</span>
    <span class='symbol'>:write</span><span class='comma'>,</span>   <span class='int'>1</span><span class='comma'>,</span>
    <span class='symbol'>:execute</span><span class='comma'>,</span> <span class='int'>1</span><span class='comma'>,</span>
    <span class='symbol'>:unused</span><span class='comma'>,</span>  <span class='int'>5</span>
<span class='kw'>end</span>

<span class='const'>Flags</span><span class='period'>.</span><span class='id identifier rubyid_bit_field_layout'>bit_field_layout</span>
<span class='comment'># =&gt; {
</span><span class='comment'>#      :value =&gt; {
</span><span class='comment'>#        :read    =&gt; { :start =&gt; 0, :width =&gt; 1 },
</span><span class='comment'>#        :write   =&gt; { :start =&gt; 1, :width =&gt; 1 },
</span><span class='comment'>#        :execute =&gt; { :start =&gt; 2, :width =&gt; 1 },
</span><span class='comment'>#        :unused  =&gt; { :start =&gt; 3, :width =&gt; 5 }
</span><span class='comment'>#      }
</span><span class='comment'>#    }</span></code></pre>
    
  </div>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>A hash where keys are parent field names and values are hashes of bit field details</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


60
61
62
63
64
65
66
67
68
69
70</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/ffi/bit_field/class_methods.rb', line 60</span>

<span class='kw'>def</span> <span class='id identifier rubyid_bit_field_layout'>bit_field_layout</span>
  <span class='kw'>return</span> <span class='lbrace'>{</span><span class='rbrace'>}</span> <span class='kw'>unless</span> <span class='id identifier rubyid_instance_variable_defined?'>instance_variable_defined?</span><span class='lparen'>(</span><span class='symbol'>:@bit_field_hash_table</span><span class='rparen'>)</span>

  <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
  <span class='ivar'>@bit_field_hash_table</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_field_name'>field_name</span><span class='comma'>,</span> <span class='id identifier rubyid_info'>info</span><span class='op'>|</span>
    <span class='id identifier rubyid_parent_name'>parent_name</span><span class='comma'>,</span> <span class='id identifier rubyid_start'>start</span><span class='comma'>,</span> <span class='id identifier rubyid_width'>width</span> <span class='op'>=</span> <span class='id identifier rubyid_info'>info</span>
    <span class='id identifier rubyid_result'>result</span><span class='lbracket'>[</span><span class='id identifier rubyid_parent_name'>parent_name</span><span class='rbracket'>]</span> <span class='op'>||=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
    <span class='id identifier rubyid_result'>result</span><span class='lbracket'>[</span><span class='id identifier rubyid_parent_name'>parent_name</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='id identifier rubyid_field_name'>field_name</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='lbrace'>{</span> <span class='label'>start:</span> <span class='id identifier rubyid_start'>start</span><span class='comma'>,</span> <span class='label'>width:</span> <span class='id identifier rubyid_width'>width</span> <span class='rbrace'>}</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_result'>result</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="bit_field_members-instance_method">
  
    #<strong>bit_field_members</strong>  &#x21d2; <tt>Hash</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns a hash of bit fields grouped by parent field.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <h4 class="tag_title">Examples:</h4>
    
      
        <h5 class="example_title"><div class='inline'>
<p>Get bit field members in a struct</p>
</div></h5>
      
      <pre class="example code"><code><span class='kw'>class</span> <span class='const'>Flags</span> <span class='op'>&lt;</span> <span class='const'><span class='object_link'><a href="../../FFI.html" title="FFI (module)">FFI</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../BitStruct.html" title="FFI::BitStruct (class)">BitStruct</a></span></span>
  <span class='id identifier rubyid_layout'>layout</span> \
    <span class='symbol'>:value</span><span class='comma'>,</span> <span class='symbol'>:uint8</span>

  <span class='id identifier rubyid_bit_fields'>bit_fields</span> <span class='symbol'>:value</span><span class='comma'>,</span>
    <span class='symbol'>:read</span><span class='comma'>,</span>    <span class='int'>1</span><span class='comma'>,</span>
    <span class='symbol'>:write</span><span class='comma'>,</span>   <span class='int'>1</span><span class='comma'>,</span>
    <span class='symbol'>:execute</span><span class='comma'>,</span> <span class='int'>1</span><span class='comma'>,</span>
    <span class='symbol'>:unused</span><span class='comma'>,</span>  <span class='int'>5</span>
<span class='kw'>end</span>

<span class='const'>Flags</span><span class='period'>.</span><span class='id identifier rubyid_bit_field_members'>bit_field_members</span>  <span class='comment'># =&gt; {:value =&gt; [:read, :write, :execute, :unused]}</span></code></pre>
    
  </div>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>A hash where keys are parent field names and values are arrays of bit field names</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


23
24
25
26
27
28
29
30
31
32
33</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/ffi/bit_field/class_methods.rb', line 23</span>

<span class='kw'>def</span> <span class='id identifier rubyid_bit_field_members'>bit_field_members</span>
  <span class='kw'>return</span> <span class='lbrace'>{</span><span class='rbrace'>}</span> <span class='kw'>unless</span> <span class='id identifier rubyid_instance_variable_defined?'>instance_variable_defined?</span><span class='lparen'>(</span><span class='symbol'>:@bit_field_hash_table</span><span class='rparen'>)</span>

  <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
  <span class='ivar'>@bit_field_hash_table</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_field_name'>field_name</span><span class='comma'>,</span> <span class='id identifier rubyid_info'>info</span><span class='op'>|</span>
    <span class='id identifier rubyid_parent_name'>parent_name</span> <span class='op'>=</span> <span class='id identifier rubyid_info'>info</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_result'>result</span><span class='lbracket'>[</span><span class='id identifier rubyid_parent_name'>parent_name</span><span class='rbracket'>]</span> <span class='op'>||=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_result'>result</span><span class='lbracket'>[</span><span class='id identifier rubyid_parent_name'>parent_name</span><span class='rbracket'>]</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_field_name'>field_name</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_result'>result</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="bit_field_offsets-instance_method">
  
    #<strong>bit_field_offsets</strong>  &#x21d2; <tt>Hash</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns a hash of bit fields with their bit offsets, grouped by parent field.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <h4 class="tag_title">Examples:</h4>
    
      
        <h5 class="example_title"><div class='inline'>
<p>Get bit field offsets in a struct</p>
</div></h5>
      
      <pre class="example code"><code><span class='kw'>class</span> <span class='const'>Flags</span> <span class='op'>&lt;</span> <span class='const'><span class='object_link'><a href="../../FFI.html" title="FFI (module)">FFI</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../BitStruct.html" title="FFI::BitStruct (class)">BitStruct</a></span></span>
  <span class='id identifier rubyid_layout'>layout</span> \
    <span class='symbol'>:value</span><span class='comma'>,</span> <span class='symbol'>:uint8</span>

  <span class='id identifier rubyid_bit_fields'>bit_fields</span> <span class='symbol'>:value</span><span class='comma'>,</span>
    <span class='symbol'>:read</span><span class='comma'>,</span>    <span class='int'>1</span><span class='comma'>,</span>
    <span class='symbol'>:write</span><span class='comma'>,</span>   <span class='int'>1</span><span class='comma'>,</span>
    <span class='symbol'>:execute</span><span class='comma'>,</span> <span class='int'>1</span><span class='comma'>,</span>
    <span class='symbol'>:unused</span><span class='comma'>,</span>  <span class='int'>5</span>
<span class='kw'>end</span>

<span class='const'>Flags</span><span class='period'>.</span><span class='id identifier rubyid_bit_field_offsets'>bit_field_offsets</span>
<span class='comment'># =&gt; {
</span><span class='comment'>#      :value =&gt; [[:read, 0], [:write, 1], [:execute, 2], [:unused, 3]]
</span><span class='comment'>#    }</span></code></pre>
    
  </div>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>A hash where keys are parent field names and values are arrays of [bit_field_name, bit_offset] pairs</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/ffi/bit_field/class_methods.rb', line 92</span>

<span class='kw'>def</span> <span class='id identifier rubyid_bit_field_offsets'>bit_field_offsets</span>
  <span class='kw'>return</span> <span class='lbrace'>{</span><span class='rbrace'>}</span> <span class='kw'>unless</span> <span class='id identifier rubyid_instance_variable_defined?'>instance_variable_defined?</span><span class='lparen'>(</span><span class='symbol'>:@bit_field_hash_table</span><span class='rparen'>)</span>

  <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>

  <span class='comment'># Get byte offsets of parent fields
</span>  <span class='id identifier rubyid_field_offsets'>field_offsets</span> <span class='op'>=</span> <span class='id identifier rubyid_offsets'>offsets</span><span class='period'>.</span><span class='id identifier rubyid_to_h'>to_h</span>

  <span class='comment'># Process each bit field
</span>  <span class='ivar'>@bit_field_hash_table</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_field_name'>field_name</span><span class='comma'>,</span> <span class='id identifier rubyid_info'>info</span><span class='op'>|</span>
    <span class='id identifier rubyid_parent_name'>parent_name</span><span class='comma'>,</span> <span class='id identifier rubyid_start'>start</span><span class='comma'>,</span> <span class='id identifier rubyid__width'>_width</span> <span class='op'>=</span> <span class='id identifier rubyid_info'>info</span>

    <span class='comment'># Get byte offset of parent field
</span>    <span class='id identifier rubyid_parent_offset'>parent_offset</span> <span class='op'>=</span> <span class='id identifier rubyid_field_offsets'>field_offsets</span><span class='lbracket'>[</span><span class='id identifier rubyid_parent_name'>parent_name</span><span class='rbracket'>]</span>
    <span class='kw'>next</span> <span class='kw'>unless</span> <span class='id identifier rubyid_parent_offset'>parent_offset</span>

    <span class='comment'># Convert byte offset to bit offset and add bit field&#39;s start position
</span>    <span class='id identifier rubyid_bit_offset'>bit_offset</span> <span class='op'>=</span> <span class='id identifier rubyid_parent_offset'>parent_offset</span> <span class='op'>*</span> <span class='int'>8</span> <span class='op'>+</span> <span class='id identifier rubyid_start'>start</span>

    <span class='comment'># Add to result
</span>    <span class='id identifier rubyid_result'>result</span><span class='lbracket'>[</span><span class='id identifier rubyid_parent_name'>parent_name</span><span class='rbracket'>]</span> <span class='op'>||=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_result'>result</span><span class='lbracket'>[</span><span class='id identifier rubyid_parent_name'>parent_name</span><span class='rbracket'>]</span> <span class='op'>&lt;&lt;</span> <span class='lbracket'>[</span><span class='id identifier rubyid_field_name'>field_name</span><span class='comma'>,</span> <span class='id identifier rubyid_bit_offset'>bit_offset</span><span class='rbracket'>]</span>
  <span class='kw'>end</span>

  <span class='comment'># Return result
</span>  <span class='id identifier rubyid_result'>result</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="bit_fields-instance_method">
  
    #<strong>bit_fields</strong>(*layout_args)  &#x21d2; <tt>Symbol</tt> 
  

  
    <span class="aliases">Also known as:
    <span class="names"><span id='bit_field-instance_method'>bit_field</span></span>
    </span>
  

  
</h3><div class="docstring">
  <div class="discussion">
    
  <div class="note notetag">
    <strong>Note:</strong>
    <div class='inline'>
<p>The total bit width should not exceed the size of the parent field. For example, a :uint8 field can hold at most 8 bits.</p>
</div>
  </div>


<p>Defines bit fields within a parent field.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <h4 class="tag_title">Examples:</h4>
    
      
        <h5 class="example_title"><div class='inline'>
<p>Define bit fields in an 8-bit integer</p>
</div></h5>
      
      <pre class="example code"><code><span class='id identifier rubyid_bit_fields'>bit_fields</span> <span class='symbol'>:flags</span><span class='comma'>,</span>
  <span class='symbol'>:read</span><span class='comma'>,</span>    <span class='int'>1</span><span class='comma'>,</span>  <span class='comment'># 1 bit for read permission
</span>  <span class='symbol'>:write</span><span class='comma'>,</span>   <span class='int'>1</span><span class='comma'>,</span>  <span class='comment'># 1 bit for write permission
</span>  <span class='symbol'>:execute</span><span class='comma'>,</span> <span class='int'>1</span><span class='comma'>,</span>  <span class='comment'># 1 bit for execute permission
</span>  <span class='symbol'>:unused</span><span class='comma'>,</span>  <span class='int'>5</span>   <span class='comment'># 5 unused bits</span></code></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>layout_args</span>
      
      
        <span class='type'>(<tt>Array</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>An array where the first element is the parent field name, followed by alternating field name and bit width pairs</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Symbol</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>parent_name The name of the parent field</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/ffi/bit_field/class_methods.rb', line 135</span>

<span class='kw'>def</span> <span class='id identifier rubyid_bit_fields'>bit_fields</span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_layout_args'>layout_args</span><span class='rparen'>)</span>
  <span class='comment'># The reason for using class instance variable here instead of class variable
</span>  <span class='comment'># is not because class instance variables are clean,
</span>  <span class='comment'># but because sub-class of FFI::Struct cannot be inherited again.
</span>  <span class='ivar'>@bit_field_hash_table</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span> <span class='kw'>unless</span> <span class='id identifier rubyid_instance_variable_defined?'>instance_variable_defined?</span><span class='lparen'>(</span><span class='symbol'>:@bit_field_hash_table</span><span class='rparen'>)</span>

  <span class='id identifier rubyid_parent_name'>parent_name</span> <span class='op'>=</span> <span class='id identifier rubyid_layout_args'>layout_args</span><span class='period'>.</span><span class='id identifier rubyid_shift'>shift</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span>
  <span class='id identifier rubyid_member_names'>member_names</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_widths'>widths</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_layout_args'>layout_args</span><span class='period'>.</span><span class='id identifier rubyid_each_slice'>each_slice</span><span class='lparen'>(</span><span class='int'>2</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='id identifier rubyid_width'>width</span><span class='op'>|</span>
    <span class='id identifier rubyid_member_names'>member_names</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_name'>name</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span>
    <span class='id identifier rubyid_widths'>widths</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_width'>width</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span>
  <span class='kw'>end</span>

  <span class='comment'># Validation: raise if total bit width exceeds parent field bit size
</span>  <span class='id identifier rubyid_parent_layout_field'>parent_layout_field</span> <span class='op'>=</span> <span class='id identifier rubyid_layout'>layout</span><span class='lbracket'>[</span><span class='id identifier rubyid_parent_name'>parent_name</span><span class='rbracket'>]</span> <span class='comment'># Returns nil if parent field not found
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_parent_layout_field'>parent_layout_field</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_parent_layout_field'>parent_layout_field</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:type</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_parent_size_bits'>parent_size_bits</span> <span class='op'>=</span> <span class='id identifier rubyid_parent_layout_field'>parent_layout_field</span><span class='period'>.</span><span class='id identifier rubyid_type'>type</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span> <span class='op'>*</span> <span class='int'>8</span>
    <span class='id identifier rubyid_total_width'>total_width</span> <span class='op'>=</span> <span class='id identifier rubyid_widths'>widths</span><span class='period'>.</span><span class='id identifier rubyid_sum'>sum</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_total_width'>total_width</span> <span class='op'>&gt;</span> <span class='id identifier rubyid_parent_size_bits'>parent_size_bits</span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Bit width </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_total_width'>total_width</span><span class='embexpr_end'>}</span><span class='tstring_content'> exceeds :</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_parent_name'>parent_name</span><span class='embexpr_end'>}</span><span class='tstring_content'> size (</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_parent_size_bits'>parent_size_bits</span><span class='embexpr_end'>}</span><span class='tstring_content'> bits)</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_starts'>starts</span> <span class='op'>=</span> <span class='id identifier rubyid_widths'>widths</span><span class='period'>.</span><span class='id identifier rubyid_each_with_index'>each_with_index</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid__width'>_width</span><span class='comma'>,</span> <span class='id identifier rubyid_index'>index</span><span class='op'>|</span> <span class='id identifier rubyid_widths'>widths</span><span class='lbracket'>[</span><span class='int'>0</span><span class='op'>...</span><span class='id identifier rubyid_index'>index</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_sum'>sum</span> <span class='rbrace'>}</span>
  <span class='id identifier rubyid_member_names'>member_names</span><span class='period'>.</span><span class='id identifier rubyid_zip'>zip</span><span class='lparen'>(</span><span class='id identifier rubyid_starts'>starts</span><span class='comma'>,</span> <span class='id identifier rubyid_widths'>widths</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='id identifier rubyid_start'>start</span><span class='comma'>,</span> <span class='id identifier rubyid_width'>width</span><span class='op'>|</span>
    <span class='ivar'>@bit_field_hash_table</span><span class='lbracket'>[</span><span class='id identifier rubyid_name'>name</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='id identifier rubyid_parent_name'>parent_name</span><span class='comma'>,</span> <span class='id identifier rubyid_start'>start</span><span class='comma'>,</span> <span class='id identifier rubyid_width'>width</span><span class='rbracket'>]</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_parent_name'>parent_name</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="bit_fields_typed-instance_method">
  
    #<strong>bit_fields_typed</strong>(parent_name, field_definitions)  &#x21d2; <tt>Symbol</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
  <div class="note notetag">
    <strong>Note:</strong>
    <div class='inline'>
<p>For fields with width 1 and type :bool, a “?” helper method is automatically created</p>
</div>
  </div>

  <div class="note notetag">
    <strong>Note:</strong>
    <div class='inline'>
<p>The total bit width should not exceed the size of the parent field.</p>
</div>
  </div>


<p>Defines typed bit fields within a parent field using hash syntax.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <h4 class="tag_title">Examples:</h4>
    
      
        <h5 class="example_title"><div class='inline'>
<p>Define typed bit fields with automatic boolean helpers</p>
</div></h5>
      
      <pre class="example code"><code><span class='id identifier rubyid_bit_fields_typed'>bit_fields_typed</span> <span class='symbol'>:flags</span><span class='comma'>,</span>
  <span class='label'>revoked:</span> <span class='lbracket'>[</span><span class='int'>1</span><span class='comma'>,</span> <span class='symbol'>:bool</span><span class='rbracket'>]</span><span class='comma'>,</span>      <span class='comment'># Creates revoked and revoked? methods
</span>  <span class='label'>expired:</span> <span class='lbracket'>[</span><span class='int'>1</span><span class='comma'>,</span> <span class='symbol'>:bool</span><span class='rbracket'>]</span><span class='comma'>,</span>      <span class='comment'># Creates expired and expired? methods
</span>  <span class='label'>some_string:</span> <span class='lbracket'>[</span><span class='int'>4</span><span class='comma'>,</span> <span class='symbol'>:string</span><span class='rbracket'>]</span> <span class='comment'># Creates some_string method</span></code></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>parent_name</span>
      
      
        <span class='type'>(<tt>Symbol</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The name of the parent field</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>field_definitions</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>A hash where keys are field names and values are arrays [width, type]</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Symbol</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>parent_name The name of the parent field</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/ffi/bit_field/class_methods.rb', line 181</span>

<span class='kw'>def</span> <span class='id identifier rubyid_bit_fields_typed'>bit_fields_typed</span><span class='lparen'>(</span><span class='id identifier rubyid_parent_name'>parent_name</span><span class='comma'>,</span> <span class='id identifier rubyid_field_definitions'>field_definitions</span><span class='rparen'>)</span>
  <span class='ivar'>@bit_field_hash_table</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span> <span class='kw'>unless</span> <span class='id identifier rubyid_instance_variable_defined?'>instance_variable_defined?</span><span class='lparen'>(</span><span class='symbol'>:@bit_field_hash_table</span><span class='rparen'>)</span>
  <span class='ivar'>@bit_field_type_table</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span> <span class='kw'>unless</span> <span class='id identifier rubyid_instance_variable_defined?'>instance_variable_defined?</span><span class='lparen'>(</span><span class='symbol'>:@bit_field_type_table</span><span class='rparen'>)</span>

  <span class='id identifier rubyid_parent_name'>parent_name</span> <span class='op'>=</span> <span class='id identifier rubyid_parent_name'>parent_name</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span>
  <span class='id identifier rubyid_member_names'>member_names</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_widths'>widths</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_types'>types</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>

  <span class='id identifier rubyid_field_definitions'>field_definitions</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='id identifier rubyid_definition'>definition</span><span class='op'>|</span>
    <span class='id identifier rubyid_width'>width</span><span class='comma'>,</span> <span class='id identifier rubyid_type'>type</span> <span class='op'>=</span> <span class='id identifier rubyid_definition'>definition</span>
    <span class='id identifier rubyid_member_names'>member_names</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_name'>name</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span>
    <span class='id identifier rubyid_widths'>widths</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_width'>width</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span>
    <span class='id identifier rubyid_types'>types</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_type'>type</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span>
  <span class='kw'>end</span>

  <span class='comment'># Validation: raise if total bit width exceeds parent field bit size
</span>  <span class='id identifier rubyid_parent_layout_field'>parent_layout_field</span> <span class='op'>=</span> <span class='id identifier rubyid_layout'>layout</span><span class='lbracket'>[</span><span class='id identifier rubyid_parent_name'>parent_name</span><span class='rbracket'>]</span> <span class='comment'># Returns nil if parent field not found
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_parent_layout_field'>parent_layout_field</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_parent_layout_field'>parent_layout_field</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:type</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_parent_size_bits'>parent_size_bits</span> <span class='op'>=</span> <span class='id identifier rubyid_parent_layout_field'>parent_layout_field</span><span class='period'>.</span><span class='id identifier rubyid_type'>type</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span> <span class='op'>*</span> <span class='int'>8</span>
    <span class='id identifier rubyid_total_width'>total_width</span> <span class='op'>=</span> <span class='id identifier rubyid_widths'>widths</span><span class='period'>.</span><span class='id identifier rubyid_sum'>sum</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_total_width'>total_width</span> <span class='op'>&gt;</span> <span class='id identifier rubyid_parent_size_bits'>parent_size_bits</span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Bit width </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_total_width'>total_width</span><span class='embexpr_end'>}</span><span class='tstring_content'> exceeds :</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_parent_name'>parent_name</span><span class='embexpr_end'>}</span><span class='tstring_content'> size (</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_parent_size_bits'>parent_size_bits</span><span class='embexpr_end'>}</span><span class='tstring_content'> bits)</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_starts'>starts</span> <span class='op'>=</span> <span class='id identifier rubyid_widths'>widths</span><span class='period'>.</span><span class='id identifier rubyid_each_with_index'>each_with_index</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid__width'>_width</span><span class='comma'>,</span> <span class='id identifier rubyid_index'>index</span><span class='op'>|</span> <span class='id identifier rubyid_widths'>widths</span><span class='lbracket'>[</span><span class='int'>0</span><span class='op'>...</span><span class='id identifier rubyid_index'>index</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_sum'>sum</span> <span class='rbrace'>}</span>

  <span class='id identifier rubyid_member_names'>member_names</span><span class='period'>.</span><span class='id identifier rubyid_zip'>zip</span><span class='lparen'>(</span><span class='id identifier rubyid_starts'>starts</span><span class='comma'>,</span> <span class='id identifier rubyid_widths'>widths</span><span class='comma'>,</span> <span class='id identifier rubyid_types'>types</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='id identifier rubyid_start'>start</span><span class='comma'>,</span> <span class='id identifier rubyid_width'>width</span><span class='comma'>,</span> <span class='id identifier rubyid_type'>type</span><span class='op'>|</span>
    <span class='ivar'>@bit_field_hash_table</span><span class='lbracket'>[</span><span class='id identifier rubyid_name'>name</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='id identifier rubyid_parent_name'>parent_name</span><span class='comma'>,</span> <span class='id identifier rubyid_start'>start</span><span class='comma'>,</span> <span class='id identifier rubyid_width'>width</span><span class='rbracket'>]</span>
    <span class='ivar'>@bit_field_type_table</span><span class='lbracket'>[</span><span class='id identifier rubyid_name'>name</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_type'>type</span>

    <span class='comment'># Generate &quot;?&quot; method for boolean fields with width 1
</span>    <span class='kw'>next</span> <span class='kw'>unless</span> <span class='id identifier rubyid_width'>width</span> <span class='op'>==</span> <span class='int'>1</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_type'>type</span> <span class='op'>==</span> <span class='symbol'>:bool</span>

    <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='symbol'>:&quot;#{</span><span class='id identifier rubyid_name'>name</span><span class='embexpr_end'>}</span><span class='tstring_content'>?</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span>
      <span class='kw'>self</span><span class='lbracket'>[</span><span class='id identifier rubyid_name'>name</span><span class='rbracket'>]</span> <span class='op'>==</span> <span class='int'>1</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_parent_name'>parent_name</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

      <div id="footer">
  Generated on Sat Oct 25 13:04:11 2025 by
  <a href="https://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.37 (ruby-3.4.7).
</div>

    </div>
  </body>
</html>